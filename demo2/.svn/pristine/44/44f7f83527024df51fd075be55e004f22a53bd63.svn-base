#include "messages.h"

/**
 * Handles the reading and processing of the path information.
 * @param player The player information.
 * @param file The file pointer to read from.
 * @return True if successfully loaded.
 */
bool read_path(Player* player, FILE* file) {
    char* buff = malloc(sizeof(char) * 80);

    if(feof(stdin)) {
        return false;
    }

    fgets(buff, 80, file);
    char* numStops = strtok(buff, ";");
    char* path = strtok(NULL, ";");

    player->numStops = atoi(numStops);
    if (strlen(path) != player->numStops * 3) {
        return false;
    }
    player->stops = malloc(sizeof(Stop) * player->numStops);
    for (int i = 0; i < player->numStops * 3; i+=3) {
        Stop *stop = malloc(sizeof(Stop));
        strncpy(stop->type, path + i, 2);

        char* cap = path + i +2;

        if (isdigit(*cap)) {
            stop->cap = atoi(cap);
        } else if (*cap == '-') {
            stop->cap = player->numPlayers;
            stop->isBarrier = true;
        } else {
            return false;
        }

        player->stops[i/3] = *stop;
    }
    return true;
}

/**
 * Prints the current status of the board.
 * @param player The player information.
 * @param file The file stream to output to.
 */
void print_board(Player* player, FILE* file){
    for (int j = 0; j < player->numStops; ++j) {
        Stop *stop = &player->stops[j];

        if (stop->isBarrier) {
            fprintf(file, "%s ", stop->type);
        } else {
            fprintf(file, "%s%d ", stop->type, stop->cap);
        }
    }
    fprintf(file, "\n");
}

