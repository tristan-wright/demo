#include "main.h"

bool read_deck(Board* board, char* deck) {
    char* buff = calloc(256, sizeof(char));

    FILE* file = fopen(deck, "r");
    if (file == NULL) {
        return false;
    }
    fgets(buff, 255, file);
    board->numCards = atoi(&buff[0]);
    if (board->numCards < 4) {
        return false;
    }

    board->cards = calloc(board->numCards, sizeof(int));
    for (int i = 1; i < board->numCards; ++i) {
        if (isalpha(buff[i]) == 0) {
            return false;
        }
        board->cards[i-1] = buff[i] - 64;
    }

    return true;
}

int game(Board* board) {
    print_board(board, stdout);
    return 0;
}


int initialise(Board* board) {
    return game(board);
}


int main(int argc, char** argv) {
    Board* board = malloc(sizeof(Board));


    if (argc < 4) {
        fprintf(stderr, "Usage: 2310dealer deck path p1 {p2}\n");
        return 1;
    }
    board->numPlayers = argc - 3;

    if (!read_deck(board, argv[1])) {
        fprintf(stderr, "Error reading deck\n");
        return 2;
    }

    FILE* path = fopen(argv[2], "r");
    if (path == NULL || !read_path(board, path)) {
        fprintf(stderr, "Error reading path\n");
        return 3;
    }


    return initialise(board);
}